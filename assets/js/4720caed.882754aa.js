"use strict";(self.webpackChunktik_wiki=self.webpackChunktik_wiki||[]).push([[5721],{1994:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"spring-boot-2-and-external-libs-with-the-properties-launcher","title":"Spring Boot 2 and external libs with the PropertiesLauncher","description":"In the world of Docker containers, Spring Boot is really a nice way of creating compact self-runnable applications","source":"@site/docs/spring-boot-2-and-external-libs-with-the-properties-launcher.md","sourceDirName":".","slug":"/spring-boot-2-and-external-libs-with-the-properties-launcher","permalink":"/docs/spring-boot-2-and-external-libs-with-the-properties-launcher","draft":false,"unlisted":false,"editUrl":"https://github.com/TikTzuki/tiktzuki.github.io/tree/master/docs/spring-boot-2-and-external-libs-with-the-properties-launcher.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docSidebar","previous":{"title":"Setup linux application script","permalink":"/docs/setup-linux-application-script"},"next":{"title":"system-design","permalink":"/docs/system-design"}}');var i=n(4848),o=n(8453);const a={},s="Spring Boot 2 and external libs with the PropertiesLauncher",l={},h=[{value:"But what if you need external libs which are not bundled?",id:"but-what-if-you-need-external-libs-which-are-not-bundled",level:2},{value:"Tell your Spring Boot Application to use the PropertiesLauncher",id:"tell-your-spring-boot-application-to-use-the-propertieslauncher",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"spring-boot-2-and-external-libs-with-the-propertieslauncher",children:"Spring Boot 2 and external libs with the PropertiesLauncher"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"In the world of Docker containers, Spring Boot is really a nice way of creating compact self-runnable applications\nwhere the needed servlet container is embedded into the executable JAR/WAR file. Creating a docker container would be a\nno brainer, if\u2026."})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://miro.medium.com/max/1312/1*uDciVmKqrDUGybzDh_koOw.png",alt:""})}),"\n",(0,i.jsxs)(t.p,{children:["\u2026 if the application to package wouldnt be a ",(0,i.jsx)(t.strong,{children:"JSP based"})," application. Because if thats the case, some major problems\narise. It starts with the fact that you cant use an executable JAR because the embedded servlet container is not able to\nfind the JSPs anymore due to the way the JAR is structured. So forget the \u201cbootJar\u201d task in gradle, you should never use\nit."]}),"\n",(0,i.jsx)(t.p,{children:"[ If you start from scratch with your application, really consider using Thymeleaf instead, because you wont have any\nissues with that templating system.]"}),"\n",(0,i.jsx)(t.p,{children:"The rescue is the \u201cbootWar\u201d task, which creates, as you can imagine, a WAR file with structure the internal\nServletContainer can handle when it comes to JSPs. If your application only consists of this WAR file and there is no\nneed to plug in customer based libraries, then you are done here. Spring will use the\norg.springframework.boot.loader.WarLauncher internally to start the application."}),"\n",(0,i.jsx)(t.h2,{id:"but-what-if-you-need-external-libs-which-are-not-bundled",children:"But what if you need external libs which are not bundled?"}),"\n",(0,i.jsx)(t.p,{children:"Most enterprise grade applications have the need to ship customer based artifacts together with the product itself. But\nmost likely you dont want to include those in the product WAR itself because that would mean that you need to have a\nbuild target for each and every customer."}),"\n",(0,i.jsx)(t.p,{children:"Let\u2019s take the following directory structure, which will be present in the docker image at the end:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://miro.medium.com/max/956/1*_BajDL92q9lA0xO8lp51Aw.png",alt:""})}),"\n",(0,i.jsx)(t.p,{children:"Our docker container loads the specified version (1.0.0) of the application from our application repository and also\nloads customers based artifacts from that repository. On starting up the container, we supply those variables like\nappVersion and customerId via Environment variables to docker. The result is a structure which is outlined above."}),"\n",(0,i.jsxs)(t.p,{children:["Now the challenge is to tell Spring that it also needs to pick up those extra JARs while bootstrapping the application.\nNeither WarLauncher nor JarLauncher will do the trick. ",(0,i.jsx)(t.strong,{children:"We need to use the PropertiesLauncher"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"When you google the web for \u201cSpring Boot PropertiesLauncher\u201d, you will notice that there are not that many useful\nanswers how to properly use it and most of them were about using PropertiesLauncher together with a executable JAR,\nwhich is a totally different thing."}),"\n",(0,i.jsx)(t.h2,{id:"tell-your-spring-boot-application-to-use-the-propertieslauncher",children:"Tell your Spring Boot Application to use the PropertiesLauncher"}),"\n",(0,i.jsx)(t.p,{children:"If you are using the Spring Boot plugin of Gradle, its quite simple to tell this plugin how to build the WAR file with a\ndifferent Launcher by just adding these lines in your gradle.build file."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-groovy",children:"bootWar {\n    enabled = true\n    manifest {\n        attributes 'Main-Class': 'org.springframework.boot.loader.PropertiesLauncher'\n    }\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"You can double check the result by unzipping the WAR artifact after build and search for the META-INF/MANIFEST.MF file.\nOpen it and you should see the reference to the PropertiesLauncher like this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"Main-Class: org.springframework.boot.loader.PropertiesLauncher"})}),"\n",(0,i.jsx)(t.p,{children:"Now the really interessting part is how to use the PropertiesLauncher on startup, because the problem with this Launcher\nis that its defaults regarding folder structure is based more or less on the JAR artifact of Spring Boot, not the WAR\none. This means that if you run this like its mentioned in the docs via:"}),"\n",(0,i.jsxs)(t.p,{children:["java -Dloader.path=file",":lib","/ \\",(0,i.jsx)(t.br,{}),"\n","-jar application-1.0.0.war"]}),"\n",(0,i.jsxs)(t.p,{children:["it ",(0,i.jsx)(t.strong,{children:"wont"})," work."]}),"\n",(0,i.jsx)(t.p,{children:"In the example i tell the PropertiesLauncher that it should pick up any libraries found in the \u201clib\u201d folder relative to\nthe war file. Instead you also need to recreate the classpath structure of the WarLauncher like this:"}),"\n",(0,i.jsxs)(t.p,{children:["java -Dloader.path=WEB-INF/lib-provided,WEB-INF/lib, \\",(0,i.jsx)(t.br,{}),"\n","WEB-INF/classes,file",":lib","/ \\",(0,i.jsx)(t.br,{}),"\n","-jar application-1.0.0.war"]}),"\n",(0,i.jsx)(t.p,{children:"So by adding all the needed classpaths to the loader.path variable, spring will be able to boostrap the application."}),"\n",(0,i.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(t.p,{children:"The PropertiesLauncher is a little bit weird to use together with the WAR artifact. It would help tremendously if there\nwould be another flag for the Launcher where you can specify what kind of artifact you have and let the Launcher create\nits main classpath itself."}),"\n",(0,i.jsx)(t.p,{children:"Something like -Dartifact.type=war|jar would be nice. But apart from that the PropertiesLauncher works as expected. It\nloads all other JARs we place into the libs folder."}),"\n",(0,i.jsx)(t.p,{children:"Also notice that we dont create customer based docker images. We have a more general container which is able to pull the\nmain application and related customer libraries out of a private AWS S3 repository on startup when needed."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["If you want to know more about well architected applications on cloud platforms or things you need to have a\nsuccessful SaaS business, feel free to head over to ",(0,i.jsx)(t.a,{href:"http://www.okaycloud.de",children:"https://okaycloud.de"})," for more\ninformation."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://medium.com/@logemann?source=post_page-----fc49d2d93636--------------------------------",children:"Marc Logemann"}),"\nMarc Logemann"]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var r=n(6540);const i={},o=r.createContext(i);function a(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);